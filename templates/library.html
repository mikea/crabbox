<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Library | Crabbox</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 24px; background: #f4f4f7; color: #222; }
      h1 { margin-top: 0; }
      .section { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 16px; max-width: 960px; }
      .muted { color: #666; }
      .link-button { display: inline-block; padding: 10px 14px; background: #0f62fe; color: #fff; border-radius: 6px; text-decoration: none; }
      .link-button:hover { background: #0b4cc0; }
      .library { padding-left: 20px; }
      .library li { margin-bottom: 4px; }
      .filter { display: flex; gap: 8px; margin: 12px 0; }
      .filter input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
      .back { text-decoration: none; color: #0f62fe; }
      .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #e0e0e0; color: #525252; font-size: 14px; }
      .footer a { color: inherit; }
      .footer a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <h1>Library</h1>

    <div class="section">
      <p>Browse the music library, search for tracks, or upload new files.</p>
      <a class="link-button" href="/upload">Upload files or folders</a>
    </div>

    <div class="section">
      <div class="filter">
        <input id="filter" type="text" placeholder="Filter tracks" aria-label="Filter library" />
      </div>
      <div id="empty-state" class="muted" style="display: none;">No tracks found.</div>
      <ul class="library" id="library-list">
        {% for track in library %}
          <li>{{ track }}</li>
        {% endfor %}
      </ul>
    </div>

    <p><a class="back" href="/">&larr; Back to player</a></p>

    {% include "footer.html" %}

    <script>
      const filterInput = document.getElementById("filter");
      const libraryList = document.getElementById("library-list");
      const emptyState = document.getElementById("empty-state");

      function renderLibrary(items) {
        libraryList.innerHTML = "";

        if (!items || items.length === 0) {
          emptyState.style.display = "block";
          return;
        }

        emptyState.style.display = "none";

        for (const track of items) {
          const li = document.createElement("li");
          li.textContent = track;
          libraryList.appendChild(li);
        }
      }

      async function loadLibrary(filter) {
        const search = filter ? `?filter=${encodeURIComponent(filter)}` : "";
        const response = await fetch(`/list_files${search}`);
        const items = await response.json();
        renderLibrary(items);
      }

      filterInput.addEventListener("input", (event) => {
        loadLibrary(event.target.value.trim());
      });

      if (!libraryList.children.length) {
        emptyState.style.display = "block";
      }
    </script>
  </body>
</html>
