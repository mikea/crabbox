<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Crabbox</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 24px; background: #f4f4f7; color: #222; }
      h1 { margin-top: 0; }
      .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; max-width: 720px; margin: 16px 0; }
      form { margin: 0; }
      button { width: 100%; padding: 10px; border: none; background: #0f62fe; color: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; }
      button:hover { background: #0b4cc0; }
      .secondary button { background: #6f6f6f; }
      .secondary button:hover { background: #525252; }
      .danger button { background: #da1e28; }
      .danger button:hover { background: #a2191f; }
      button.danger { background: #da1e28; }
      button.danger:hover { background: #a2191f; }
      .queue, .library { padding-left: 20px; }
      .command { margin: 16px 0; max-width: 480px; display: flex; gap: 8px; }
      .command input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
      .section { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 16px; }
      .muted { color: #666; }
      .link-button { display: inline-block; padding: 10px 14px; background: #0f62fe; color: #fff; border-radius: 6px; text-decoration: none; }
      .link-button:hover { background: #0b4cc0; }
      .tags { padding-left: 20px; }
      .tags li { margin-bottom: 4px; }
      .inline-form { display: inline-block; margin-left: 8px; }
      .inline-form button { width: auto; padding: 8px 12px; }
      .queue-actions { display: inline-block; margin-bottom: 12px; max-width: 200px; }
      .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #e0e0e0; color: #525252; font-size: 14px; }
      .footer a { color: inherit; }
      .footer a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    {% macro tag_assignment(tag) -%}
      <span class="muted">{{ tag.id }}</span> Â· Command: <span class="muted">{{ tag.command | default("Unassigned") }}</span> <a class="link-button" href="/edit_tag/{{ tag.id }}">Edit tag</a>
      <form method="post" action="/activate_tag/{{ tag.id }}" class="inline-form">
        <button type="submit">Activate</button>
      </form>
    {%- endmacro %}
    <h1>Crabbox</h1>
    <div class="section">
      <p>Current track: <span class="muted">{{ current }}</span></p>
      {% if last_tag %}
        <p>Last tag: {{ tag_assignment(last_tag) }}</p>
      {% else %}
        <p>Last tag: <span class="muted">None</span></p>
      {% endif %}
      <div class="controls">
        <form method="post" action="/play">
          <button type="submit">Play</button>
        </form>
        <form method="post" action="/playpause">
          <button type="submit">Play / Pause</button>
        </form>
        <form method="post" action="/stop" class="secondary">
          <button type="submit">Stop</button>
        </form>
        <form method="post" action="/prev">
          <button type="submit">Previous</button>
        </form>
        <form method="post" action="/next">
          <button type="submit">Next</button>
        </form>
        <form method="post" action="/volume-down" class="secondary">
          <button type="submit">Volume Down</button>
        </form>
        <form method="post" action="/volume-up" class="secondary">
          <button type="submit">Volume Up</button>
        </form>
        <form method="post" action="/shutdown" class="danger">
          <button type="submit">Shutdown</button>
        </form>
      </div>
    </div>

    <div class="section">
      <form method="post" action="/command" class="command">
        <input type="text" name="command" placeholder="Enter command e.g. PLAY chill/*" />
        <button type="submit">Run</button>
      </form>
    </div>

    <div class="section">
      <h2>Current queue</h2>
      <form method="post" action="/clear-queue" class="queue-actions danger">
        <button type="submit">Clear queue</button>
      </form>
      {% if queue | length == 0 %}
        <p>Queue is empty</p>
      {% else %}
        <ol class="queue">
          {% for item in queue %}
            {% if item.is_current %}
              <li><strong>{{ item.name }}</strong></li>
            {% else %}
              <li>{{ item.name }}</li>
            {% endif %}
          {% endfor %}
        </ol>
      {% endif %}
    </div>

    <div class="section">
      <h2>Tags</h2>
      {% if tags | length == 0 %}
        <p>No tag assignments.</p>
      {% else %}
        <ul class="tags">
          {% for tag in tags %}
            <li>{{ tag_assignment(tag) }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    <div class="section">
      <h2>Library</h2>
      <p>Manage your music library, browse tracks, and upload new files.</p>
      <a class="link-button" href="/library">Manage library</a>
    </div>

    {% include "footer.html" %}
  </body>
</html>
